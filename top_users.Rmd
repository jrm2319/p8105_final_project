---
title: "Top Users By Ratings"
author: "Samiha Reza"
date: "2024-12-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(plotly)
library(readr)
library(tidyverse)
ratings <- read_csv("./ratings.csv")
to_read <- read_csv("./to_read.csv")
books_with_tags <- read_csv("./books_with_tags.csv")
```

```{r data_1}
users_ratings <- ratings %>%
  group_by(user_id) %>%
  summarize(total_ratings = n(), .groups = 'drop') %>%
  arrange(desc(total_ratings))

```

```{r ratings_users, echo = FALSE}

top_user_ids_rat <- users_ratings %>%
  head(15)

top_ratings <- semi_join(ratings, top_user_ids_rat, by = c("user_id"))
# Things to do: Look at average rating for top 15 users, look at most common genres rated for each user (use pie chart)

avg_rat <-top_ratings %>%
  group_by(user_id) %>%  
  summarize(avg_rating = mean(rating, na.rm = TRUE))

top_users <- left_join(top_user_ids_rat, avg_rat, by = c("user_id"))

top_ratings_genres <- left_join(top_ratings, books_with_tags, by = c("book_id")) %>%
  group_by(user_id) %>% 
  pivot_longer(cols = starts_with("top"),
               names_to = "tag_type",
              values_to = "tag") %>%
  group_by(user_id, tag) %>%
  summarise(tag_count = n(), .groups = "drop") %>%
  drop_na(tag) %>%
  group_by(user_id) %>%
  slice_max(order_by = tag_count, n = 3) %>%
  ungroup()
#top 3 genres for top 15 raters

genres_count <- top_ratings_genres %>%
  count(tag)

```

```{r plot}
genres_count %>%
  plot_ly(labels = ~tag, values = ~n, type = "pie", colors = "viridis")
  
```
  

```

```{r plot}
genres_count %>%
  plot_ly(labels = ~tag, values = ~n, type = "pie", colors = "viridis")
  
```

